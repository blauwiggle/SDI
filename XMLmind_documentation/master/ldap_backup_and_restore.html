<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>10.&nbsp;Backup and recovery / restore</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Documentation &#34;Software Defined Infrastructure&#34; in summer term 2020 (Group 8)"><link rel="up" href="ldap.html" title="Chapter&nbsp;3.&nbsp;LDAP"><link rel="prev" href="ldap_ldap_based_user_login.html" title="9.&nbsp;LDAP based user login"><link rel="next" href="ldap_ldap_python.html" title="11.&nbsp;Accessing LDAP by a Python Application"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.&nbsp;Backup and recovery / restore</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ldap_ldap_based_user_login.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;LDAP</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ldap_ldap_python.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ldap_backup_and_restore"></a>10.&nbsp;Backup and recovery / restore</h2></div></div></div><p>First we set up a replica LDAP server on our B machine.</p><p>Then we created the backup LDIF files from our LDAP server on the A machine, using the <span class="command"><strong>slapcat</strong></span> command:</p><pre class="screen">slapcat -n 0 -l config.ldif
slapcat -n 1 -l data.ldif</pre><p>The <em class="parameter"><code>-n 0</code></em> parameter backups the configuration database and the <em class="parameter"><code>-n 1</code></em> parameter the actual data database.</p><p>To restore these data to our B machine LDAP server, we first stopped the server, using:</p><pre class="screen">service slapd stop</pre><p>Then we restored the data from the backup LDIF files with the <span class="command"><strong>slapadd</strong></span> command:</p><pre class="screen">slapadd -n 0 -F /etc/openldap/slapd.d -l ~/config.ldif
slapadd -n 1 -F /etc/openldap/slapd.d -l ~/data.ldif</pre><p>The first parameter gives the path to the server's configuration directory, the second one to the backup file.</p><p>Next, we made the user <code class="code">openldap</code> the owner of the folders, which now contained the configuration and actual user data.</p><pre class="screen">chown -R openldap:openldap /etc/openldap/slapd.d
chown -R openldap:openldap /var/lib/ldap</pre><p>Then we restarted the server and now it contained all the configuration and user data of our server on the A machine.</p><pre class="screen">service slapd start</pre></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ldap_ldap_based_user_login.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ldap.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ldap_ldap_python.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">9.&nbsp;LDAP based user login&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;11.&nbsp;Accessing LDAP by a Python Application</td></tr></table></div></body></html>